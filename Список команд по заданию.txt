from django.contrib.auth.models import User
from newsportal.models import * 

u1=User.objects.create_user('Иван')            
u2=User.objects.create_user('Павел') 
a1=Author.objects.create(user=u1)  
a2=Author.objects.create(user=u2) 
cat1=Category.objects.create(name='политика')
cat2=Category.objects.create(name='юмор')
cat3=Category.objects.create(name='финансы')
cat4=Category.objects.create(name='хайтек')
p1=Post.objects.create(title_of_post="В России заработало беспилотное такси",author=Author.objects.get(id=1),post_text="28 августа 2018 года в Иннополисе впервые заработало беспилотное такси «Яндекса». Одним из первых пассажиров беспилотника стал президент РТ Рустам Минниханов. Так, Иннополис стал первым городом Европы, в котором заработала система беспилотного такси.")
p2=Post.objects.create(title_of_post="Как зареги­стри­ровать ИП",author=Author.objects.get(id=2),post_text="Статус ИП оптимален для тех, у кого небольшой бизнес. При этом ограничений на размер оборотов нет — просто нужно будет выбрать подходящую систему налогообложения. ИП легче зарегистрировать и закрыть, чем ООО.")
p3=Post.objects.create(title_of_post="Пошлина на экспорт нефти из России выросла на 2,5 доллара",author=Author.objects.get(id=1),post_text="Пошлина на экспорт нефти из России с 1 октября повышается на 2,5 доллара - до 23,9 доллара за тонну, следует из данных Минфина.",news_or_article="news")
c1=Comment.objects.create(comment_text="тестовый коммент1",user=a1,post=p1)
c2=Comment.objects.create(comment_text="тестовый коммент2",user=a1,post=p2)
c3=Comment.objects.create(comment_text="тестовый коммент3",user=a2,post=p3)
c4=Comment.objects.create(comment_text="тестовый коммент1",user=a1,post=p3)
p1.category.add(cat4)
p1.category.add(cat1)
p2.category.add(cat3)
p2.category.add(cat1)
p3.category.add(cat3)
p3.category.add(cat1)
c2.like()
c2.like()
c3.dislike()
c3.dislike()
c3.dislike()
c3.dislike()
c4.like()
c4.like()
p1.like()
p1.like()
p1.like()
p1.like()
p1.like()
p1.like()
p2.like()
p2.like()
p3.dislike()
p3.dislike()
p3.dislike()
p3.dislike()
p3.dislike()

a1.update_rating()       
a2.update_rating()

best_user=Author.objects.prefetch_related().all().order_by('-author_rating').values('user__username', 'author_rating',).first()
print(best_user)

best_post_id=Post.objects.all().order_by('-post_rating').values('id').first()
print(str(Post.objects.all().order_by('-post_rating').values('date_of_post','author__user__username','post_rating','title_of_post').first()) + 'preview:' + Post.objects.get(id=best_post_id.get('id')).preview())
print(Comment.objects.filter(post=Post.objects.get(id=best_post_id.get('id'))).values('date_of_comment','user__user__username','comment_rating','comment_text'))
